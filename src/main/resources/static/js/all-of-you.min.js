$("#check-button").click(function () {
    if (check_string($("#check-name").val()) == 1) {
        $.ajax({
            url: "/api-v1/verify",
            type: "POST",
            data: {
                name: $("#check-name").val()
            },
            success(result) {
                console.log("success!");
                if (result == "not-book") {
                    alert("暂时没有找到您的预定信息，您可以在上方预定~");
                } else if (result == ("book-as-owner")) {
                    window.location.href = "/wait";
                } else if (result == ("book-as-customer")) {
                    window.location.href = "/wait";
                } else {
                    alert("出错了，请点击刷新按钮之后重试！");
                }
            },
            error(result) {
                alert("出错了，请点击刷新按钮之后重试！");
            }

        })
    } else {
        alert("请输入合法的名字 ：）\n 合法：\n1.字数大于0\n2.字数小于10");
    }
});

function check_string(s) {
    var s1 = s + "";
    if (s1.length <= 0 || s1.length >= 10) {
        return -1;
    } else {
        return 1;
    }
};
$("#book-button").click(function () {
    if (check_string($("#ownerName").val()) == 1 && check_string($("input[name='ownerGender']:checked").val()) == 1 && check_string($("#customerName").val()) == 1 && check_string($("input[name='custmerGender']:checked").val()) == 1) {
        $.ajax({
            url: "/api-v1/book",
            type: "POST",
            data: {
                ownerName: $("#ownerName").val(),
                ownerGender: $("input[name='ownerGender']:checked").val(),
                customerName: $("#customerName").val(),
                customerGender: $("input[name='customerGender']:checked").val()
            },
            success(result) {
                console.log("success!");
                if (result == "book-success") {
                    alert("预约成功！");
                    window.location.href = "/choose";
                } else if (result == ("name-already-booked")) {
                    alert("名字被预约了！换个名字吧");
                    window.location.href = "/bookMv";
                } else {
                    alert("出错了，请点击刷新按钮之后重试！");
                }
            },
            error(result) {
                alert("出错了，请点击刷新按钮之后重试！");
            }

        })
    } else {
        alert("填写的格式不对，快检查检查！")
    }
});


function AddSth() {

    $.ajax({
        type: 'POST',
        url: "api-v1/getAllMvList",
        data: {
            page: $(".main").attr("id")
        },
        success: function (result) {


            console.log(result[0].mvNum);
            json = result;
            for (var i in json) {
                var tbBody = "<option style='align-content: center'  value='" + json[i].mvNum + "'>《" + json[i].mvName + "》</option>";

                $(".main").append(tbBody);
            }

        }
    });
};
$("#apply").click(function () {
    if ($("#films").val() != null) {
        $.ajax({
            type: 'POST',
            url: "api-v1/changeMvNum",
            data: {
                MvNum: $("#films").val()
            },
            success: function (result) {
                if (result == "change-success") {
                    alert("预定成功");
                    window.location.href = "/index";
                }

            }
        })
        ;
    } else {
        alert("请选择电影：）")
    }
});


function sleep(seconds) {
    var start = (new Date()).getTime();
    while ((new Date()).getTime() - start < seconds * 1000) {
        continue;
    }
};

function isAllIn() {
    $.ajax({
        type: 'POST',
        url: "api-v1/isAllIn",
        timeout:5000,
        success: function (result) {
            if (result == "all-in") {
                window.location.replace ("/watch");
            }

        },
        error:function () {
            isAllIn();
        }
    });
};

function allInPoll(delaySeconds, seconds) {
    sleep(delaySeconds);
    setInterval(function () {
        isAllIn();
    }, seconds*1000);

};
